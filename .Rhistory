)
)
length(which(x$ClosureYN=="Y"))
minnetonka <- # change true and false to Y and N
minnetonka %>%
mutate(
ClosureYN = if_else(
condition = str_detect(
string = ClosureYN,
pattern = "TRUE"
),
true = "Y",
false = "N"
)
)
unique(minnetonka$Notes)
x <-
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3"
),
true = "Retested value use",
false = NA
)
x <-
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3",
true = "Retested value use",
false = NA
)
)
View(x)
x <-
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3",
true = "Retested value used",
false = NA
)
)
minnetonka <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3",
true = "Retested value used",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "**Possible contamination",
true = "Possible sample contamination",
false = Notes
)
)
x <- # import first sheet
read_xlsx(
path = path,
sheet = 1
)
name <- names(x)[1] # grab lake name
names(x) <- x[1, ] # Make first row into column names
x <- x[-1, ] # Remove first row
colnames(x)[11] <- "Temporary1" # name unnamed col
colnames(x)[12] <- "Temporary2" # name unnamed col
x <- # add lake name column
x %>%
mutate(
BeachName = str_remove(
string = name,
pattern = " Beach"
),
.before = Date
)
## standardize col names
str(x)
x <- # standardize col names
x %>%
rename(
"sample1" = ES,
"sample2" = ED,
"sample3" = WS,
"sample4" = WD,
"sample5" = C
)
y <- # import second sheet
read_xlsx(
path = path,
sheet = 2
)
name <- names(y)[1] # grab lake name
names(y) <- y[1, ] # Make first row into column names
y <- y[-1, ] # Remove first row
colnames(y)[11] <- "Temporary1" # name unnamed col
colnames(y)[12] <- "Temporary2" # name unnamed col
y <- # add lake name
y %>%
mutate(
BeachName = str_remove(
string = name,
pattern = " Beach"
),
.before = Date
)
## standardize col names
str(y)
y <- # standardize col names
y %>%
rename(
"sample1" = SS,
"sample2" = SD,
"sample3" = NS,
"sample4" = ND,
"sample5" = C
)
minnetonka_raw <- # bind the df's into one
rbind(x, y)
minnetonka <- minnetonka_raw # create df to manipulate
# Look at format of df's----
str(minnetonka)
summary(minnetonka)
# Change values that are "<1" to 0
minnetonka <-
minnetonka %>%
mutate(
across(
.cols = 3:9,
.fns = ~ str_replace(
string = .x,
pattern = "<1",
replacement = "0"
)
)
)
# Convert numeric rows from character to numeric----
minnetonka <-
minnetonka %>%
mutate(
across(
.cols = 2:10,
.fns = as.numeric
)
)
# Convert dates to format in master csv----
minnetonka <- # convert numeric date to date format
minnetonka %>%
mutate(
Date = as_date(
Date,
origin = "1899-12-30"
)
)
str(minnetonka)
summary(minnetonka)
## One row did not convert correctly -> this is Libbs Lake during 2016
## No data, remove this row
minnetonka <-
minnetonka %>%
drop_na(
"sample1"
)
### Difficulty getting to character format; skipping for now
# Denote when beaches were closed----
## Look at values in non-numeric cols
str(minnetonka)
unique(minnetonka$Notes)
### retesting value = 6.3, possible contamination, CLOSED
unique(minnetonka$Temporary1)
### closed, CLOSED
unique(minnetonka$Temporary2)
### No notes that need recording
## Make changes to note beach closures and other notes----
### create beach closure col
minnetonka <-
minnetonka %>%
mutate( # replace value with retested value
sample3 = if_else(
condition = sample3 == 200.5,
true = 6.3,
false = sample3
)
)
x <- # create vector that identifies presence of closed in Notes col
str_detect(
string = minnetonka$Notes,
pattern = "CLOSED"
)
y <- # create vector that identifies presence of closed in Temporary1 col
str_detect(
string = minnetonka$Temporary1,
pattern = "CLOSED | closed"
)
minnetonka <- # add x and y as new cols to minnetonka
minnetonka %>%
mutate(
Temporary3 = x,
Temporary4 = y
)
minnetonka <- # combine x and y cols into ClosureYN
minnetonka %>%
unite(
col = "ClosureYN",
Temporary3, Temporary4,
sep = ""
)
minnetonka <- # change true and false to Y and N
minnetonka %>%
mutate(
ClosureYN = if_else(
condition = str_detect(
string = ClosureYN,
pattern = "TRUE"
),
true = "Y",
false = "N"
)
)
# To notes column, use language provided by BF for contamination and retesting
unique(minnetonka$Notes)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3" |
Notes = "Possible sample contamination",
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3" |
Notes == "Possible sample contamination",
true = "Suspicious",
false = N
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3" |
Notes == "Possible sample contamination",
true = "Suspicious",
false = "N"
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3|Possible sample contamination",
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3",
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = Notes == "Retest of WS was 6.3" |
Notes == "Possible sample contamination",
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
Notes == "Retest of WS was 6.3" |
Notes == "Possible sample contamination",
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
Notes == str_detect(
string = Notes,
pattern = "contamination | retest"
),
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
str_detect(
string = Notes,
pattern = "contamination | retest"
),
true = "Suspicious",
false = NA
)
)
x <- # note the retest in Notes
minnetonka %>%
mutate(
Notes = if_else(
condition = str_detect(
string = Notes,
pattern = "contamination | retest"
),
true = "Suspicious",
false = NA
)
)
x <- # create new notes col using a temporary col, rename original notes col
rename(
Temporary3 = Notes,
Notes = Temporary2
)
x <- # create new notes col using a temporary col, rename original notes col
minnetonka %>%
rename(
Temporary3 = Notes,
Notes = Temporary2
)
y <-
x %>%
mutate(
Notes = NA
)
View(y)
z <-
y %>%
mutate(
Notes = if_else(
condition = Temporary3 == "**Possible contamination"
),
true = "suspicious"
)
z <-
y %>%
mutate(
Notes = if_else(
condition = Temporary3 == "**Possible contamination"
),
true = "suspicious",
false = Notes
)
z <-
y %>%
mutate(
Notes = if_else(
condition = Temporary3 == "**Possible contamination",
true = "suspicious",
false = Notes
)
)
View(z)
condition = Temporary3 == "Retest of WS was 6.3",
z <-
y %>%
mutate(
Notes = if_else(
condition = Temporary3 == "**Possible contamination",
true = "suspicious",
false = Notes
),
Notes = if_else(
condition = Temporary3 == "Retest of WS was 6.3",
true = "suspicious",
false = Notes
)
)
minnetonka <- # create new notes col using a temporary col, rename original notes col
minnetonka %>%
rename(
Temporary3 = Notes,
Notes = Temporary2
)
minnetonka <- # make Notes col only NA values
minnetonka %>%
mutate(
Notes = NA
)
minnetonka <- # note that contaminated and retested data as suspicioius
minnetonka %>%
mutate(
Notes = if_else(
condition = Temporary3 == "**Possible contamination",
true = "suspicious",
false = Notes
),
Notes = if_else(
condition = Temporary3 == "Retest of WS was 6.3",
true = "suspicious",
false = Notes
)
)
View(minnetonka)
x <-
minnetonka %>%
mutate(
Ecoli_30dGM = NA,
Ecoli_units = "cfu",
Entero_avg_cfu = NA,
Microcystin_ugL = NA,
Cylindro_ugL = NA,
Anatoxin_ugL = NA,
ClosureReason = NA,
MonitoringOrg = "Minnetonka"
)
View(x)
x <-
minnetonka %>%
mutate(
DNRID = if_else(
condition = BeachName == "Shady Oak",
true = "27-0089",
false = NA
)
)
minnetonka <- # add DNRID for shady oak
minnetonka %>%
mutate(
DNRID = if_else(
condition = BeachName == "Shady Oak",
true = "27-0089",
false = NA
)
)
x <- # add DNRID for shady oak
minnetonka %>%
mutate(
DNRID = if_else(
condition = BeachName == "Libbs Lake",
true = "27-0085",
false = DNRID
)
)
minnetonka <- # add DNRID for shady oak
minnetonka %>%
mutate(
DNRID = if_else(
condition = BeachName == "Libbs Lake",
true = "27-0085",
false = DNRID
)
)
str(minnetonka)
x <-
minnetonka %>%
rename(
Temp_F = "Ambient Water Temp. oF"
)
View(x)
x <-
minnetonka %>%
select(
!c(
"Composite E. coli (CFU/100ml)",
"5-Sample Geo. Mean E. coli (CFU/100ml):",
Temporary3,
Temporary1
)
)
x <-
minnetonka %>%
select(
!c(
"Composite E. coli (CFU/100ml)",
"5-Sample Geo. Mean E. coli (CFU/100ml)",
Temporary3,
Temporary1
)
)
minnetonka <-
minnetonka %>%
rename(
Temp_F = "Ambient Water Temp. oF"
)
x <-
minnetonka %>%
select(
!c(
"Composite E. coli (CFU/100ml)",
"5-Sample Geo. Mean E. coli (CFU/100ml)",
Temporary3,
Temporary1
)
)
minnetonka <-
minnetonka %>%
select(
!c(
"Composite E. coli (CFU/100ml)",
"5-Sample Geo. Mean E. coli (CFU/100ml)",
Temporary3,
Temporary1
)
)
